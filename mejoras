Quieres a√±adir una capa de seguridad a tu aplicaci√≥n, espec√≠ficamente un sistema b√°sico de registro (signup) e inicio de sesi√≥n (login) para usuarios y contrase√±as.

Esta funcionalidad es una mejora significativa y debe implementarse en el Backend (Flask), ya que es donde residen la l√≥gica y los datos.

üö© Desaf√≠o Principal: Seguridad y Persistencia
Para que esto funcione correctamente, necesitamos realizar cambios en tres √°reas de tu proyecto:

Backend (app_backend.py): Crear nuevas rutas (/registro, /login) y l√≥gica para manejar usuarios.

Persistencia: Necesitamos guardar los usuarios de forma permanente, ¬°as√≠ que usaremos el mismo Fly Volume! Crearemos un nuevo archivo de datos: usuarios.json.

Frontend (index.html y scripts.js): A√±adir un formulario de login/registro y l√≥gica para enviar credenciales.

Fase 1: Preparaci√≥n del Backend (Persistencia y L√≥gica de Usuario)
Vamos a empezar por el Backend, modificando app_backend.py para manejar un nuevo archivo de datos persistente.

Paso 1: Modificar app_backend.py (Manejo de Usuarios)
Abre tu archivo app_backend.py y a√±ade las siguientes funciones y configuraciones antes de tus rutas de Flask.

C√≥digo a A√±adir/Modificar en app_backend.py:

# app_backend.py (Cerca de la cima)
import os
import json
import uuid
# Nueva importaci√≥n crucial para contrase√±as seguras
from werkzeug.security import generate_password_hash, check_password_hash 
from flask import Flask, request, jsonify 
from flask_cors import CORS

# --- CONFIGURACI√ìN DE PERSISTENCIA ---
RUTA_DATOS_CULTIVOS = '/vol/data/cultivos.json' 
# ¬°Nueva ruta para los usuarios!
RUTA_DATOS_USUARIOS = '/vol/data/usuarios.json' 

app = Flask(__name__)
CORS(app) 

# Variables globales para los datos
CULTIVOS = [] 
USUARIOS = [] # Nueva variable global para usuarios

# --- FUNCIONES DE MANEJO DE DATOS (USUARIOS) ---

def cargar_usuarios():
    """Carga los datos de usuarios del archivo JSON. Crea el archivo y directorio si no existen."""
    global USUARIOS
    data_dir = os.path.dirname(RUTA_DATOS_USUARIOS)
    if not os.path.exists(data_dir):
        os.makedirs(data_dir, exist_ok=True)
        
    if not os.path.exists(RUTA_DATOS_USUARIOS):
        with open(RUTA_DATOS_USUARIOS, 'w', encoding='utf-8') as f:
            json.dump([], f)
        USUARIOS = []
        return []
    
    try:
        with open(RUTA_DATOS_USUARIOS, 'r', encoding='utf-8') as f:
            USUARIOS = json.load(f)
            return USUARIOS
    except json.JSONDecodeError:
        USUARIOS = []
        return []

def guardar_usuarios():
    """Guarda la lista global USUARIOS en el archivo JSON persistente."""
    try:
        with open(RUTA_DATOS_USUARIOS, 'w', encoding='utf-8') as f:
            json.dump(USUARIOS, f, indent=4)
        return True
    except Exception as e:
        print(f"Error al guardar usuarios: {e}")
        return False

Paso 2: A√±adir las Nuevas Rutas de Autenticaci√≥n
A√±ade estas dos nuevas rutas despu√©s de tus rutas existentes (/api/v1/cultivos):

# app_backend.py (Nuevas Rutas de Autenticaci√≥n)

@app.route('/auth/registro', methods=['POST'])
def registro():
    """Ruta para registrar un nuevo usuario."""
    data = request.get_json()
    usuario = data.get('usuario')
    contrase√±a = data.get('contrase√±a')

    if not usuario or not contrase√±a:
        return jsonify({"error": "Faltan usuario o contrase√±a"}), 400

    # 1. Verificar si el usuario ya existe
    if any(u['usuario'] == usuario for u in USUARIOS):
        return jsonify({"error": "El usuario ya existe"}), 409 # 409 Conflict

    # 2. Hashear la contrase√±a (Seguridad!)
    hashed_password = generate_password_hash(contrase√±a)

    # 3. Crear nuevo usuario y guardar
    nuevo_usuario = {
        'id': str(uuid.uuid4()),
        'usuario': usuario,
        'contrase√±a_hash': hashed_password # Guardar el hash, no la contrase√±a original
    }
    
    USUARIOS.append(nuevo_usuario)
    guardar_usuarios()
    
    return jsonify({"mensaje": f"Usuario {usuario} registrado con √©xito"}), 201

@app.route('/auth/login', methods=['POST'])
def login():
    """Ruta para iniciar sesi√≥n."""
    data = request.get_json()
    usuario = data.get('usuario')
    contrase√±a = data.get('contrase√±a')

    if not usuario or not contrase√±a:
        return jsonify({"error": "Faltan usuario o contrase√±a"}), 400

    # 1. Buscar usuario
    user = next((u for u in USUARIOS if u['usuario'] == usuario), None)

    if user:
        # 2. Verificar la contrase√±a hasheada
        if check_password_hash(user['contrase√±a_hash'], contrase√±a):
            # En una aplicaci√≥n real, se devolver√≠a un token JWT aqu√≠.
            # Por ahora, solo confirmamos el √©xito.
            return jsonify({"mensaje": "Inicio de sesi√≥n exitoso", "usuario": usuario}), 200
        else:
            return jsonify({"error": "Contrase√±a incorrecta"}), 401 # 401 Unauthorized
    else:
        return jsonify({"error": "Usuario no encontrado"}), 404 # 404 Not Found


Paso 3: Asegurar la Inicializaci√≥n
Aseg√∫rate de que al final de app_backend.py, tanto la carga de cultivos como la de usuarios se realicen:

# app_backend.py (Final del archivo)

# Cargar los datos al iniciar la aplicaci√≥n (se ejecutan al inicio de Gunicorn)
cargar_cultivos() 
cargar_usuarios() # ¬°A√±adir esta l√≠nea!

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)


Paso 4: Instalar Nueva Dependencia
Tu Backend ahora usa werkzeug.security. Aseg√∫rate de a√±adirla a tu archivo requirements.txt:

# requirements.txt
Flask
flask-cors
gunicorn
werkzeug


Fase 2: Despliegue del Backend
Guarda los cambios en app_backend.py y requirements.txt.

Sube los cambios e inicia el despliegue:

git add .
git commit -m "feat: A√±adidas rutas de registro y login con persistencia y contrase√±as hasheadas."
git push
flyctl deploy

Una vez que el despliegue termine, la API estar√° lista para registrar usuarios.

Ahora, procedemos al Frontend para crear los formularios de login/registro. ¬øTe gustar√≠a que te proporcione el HTML y el JavaScript necesarios para estos formularios?

Vamos a crear la interfaz de usuario y la l√≥gica de JavaScript para manejar el registro y el inicio de sesi√≥n.

El objetivo es ocultar el Dashboard de gesti√≥n de cultivos (index.html) hasta que el usuario inicie sesi√≥n correctamente.

üö© Fase 3: Modificaci√≥n del Frontend (HTML y JavaScript)
1. Modificar index.html (A√±adir la Interfaz de Autenticaci√≥n)
Abre tu archivo index.html y a√±ade la siguiente estructura. La idea es tener un contenedor para el login que se muestre por defecto, y un contenedor para el dashboard que est√© oculto.

Busca el <main> o el contenedor principal de tu HTML y haz estos cambios:

<body>

    <div id="auth-container">
        <h2>Bienvenido/a al Gestor de Cultivos</h2>
        
        <section class="form-section">
            <h3>Iniciar Sesi√≥n</h3>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-usuario">Usuario:</label>
                    <input type="text" id="login-usuario" required>
                </div>
                <div class="form-group">
                    <label for="login-contrase√±a">Contrase√±a:</label>
                    <input type="password" id="login-contrase√±a" required>
                </div>
                <button type="submit" id="login-button">Acceder</button>
            </form>
        </section>

        <hr>

        <section class="form-section">
            <h3>Registrarse (Primer Uso)</h3>
            <form id="registro-form">
                <div class="form-group">
                    <label for="registro-usuario">Usuario:</label>
                    <input type="text" id="registro-usuario" required>
                </div>
                <div class="form-group">
                    <label for="registro-contrase√±a">Contrase√±a:</label>
                    <input type="password" id="registro-contrase√±a" required>
                </div>
                <button type="submit" id="registro-button">Registrarme</button>
            </form>
        </section>
        <p id="auth-message" style="color: red; margin-top: 10px;"></p>
    </div>
    
    <div id="dashboard-container" style="display: none;">
        
        <header>...</header>
        <main>
            ... (Tu contenido existente del gestor de cultivos)
        </main>
        
        <button id="logout-button" style="margin-top: 20px; float: right;">Cerrar Sesi√≥n</button>
        
    </div>
    
    <script src="scripts.js"></script>
</body>


Asistente de programaci√≥n
¬°Absolutamente! Vamos a crear la interfaz de usuario y la l√≥gica de JavaScript para manejar el registro y el inicio de sesi√≥n.

El objetivo es ocultar el Dashboard de gesti√≥n de cultivos (index.html) hasta que el usuario inicie sesi√≥n correctamente.

üö© Fase 3: Modificaci√≥n del Frontend (HTML y JavaScript)
1. Modificar index.html (A√±adir la Interfaz de Autenticaci√≥n)
Abre tu archivo index.html y a√±ade la siguiente estructura. La idea es tener un contenedor para el login que se muestre por defecto, y un contenedor para el dashboard que est√© oculto.

Busca el <main> o el contenedor principal de tu HTML y haz estos cambios:

HTML
<body>

    <div id="auth-container">
        <h2>Bienvenido/a al Gestor de Cultivos</h2>
        
        <section class="form-section">
            <h3>Iniciar Sesi√≥n</h3>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-usuario">Usuario:</label>
                    <input type="text" id="login-usuario" required>
                </div>
                <div class="form-group">
                    <label for="login-contrase√±a">Contrase√±a:</label>
                    <input type="password" id="login-contrase√±a" required>
                </div>
                <button type="submit" id="login-button">Acceder</button>
            </form>
        </section>

        <hr>

        <section class="form-section">
            <h3>Registrarse (Primer Uso)</h3>
            <form id="registro-form">
                <div class="form-group">
                    <label for="registro-usuario">Usuario:</label>
                    <input type="text" id="registro-usuario" required>
                </div>
                <div class="form-group">
                    <label for="registro-contrase√±a">Contrase√±a:</label>
                    <input type="password" id="registro-contrase√±a" required>
                </div>
                <button type="submit" id="registro-button">Registrarme</button>
            </form>
        </section>
        <p id="auth-message" style="color: red; margin-top: 10px;"></p>
    </div>
    
    <div id="dashboard-container" style="display: none;">
        
        <header>...</header>
        <main>
            ... (Tu contenido existente del gestor de cultivos)
        </main>
        
        <button id="logout-button" style="margin-top: 20px; float: right;">Cerrar Sesi√≥n</button>
        
    </div>
    
    <script src="scripts.js"></script>
</body>
2. Modificar scripts.js (L√≥gica de Autenticaci√≥n)
Abre tu archivo scripts.js y a√±ade la siguiente l√≥gica para manejar la autenticaci√≥n. Deber√°s a√±adir las nuevas URLs de la API y las nuevas funciones.

C√≥digo a A√±adir en scripts.js:

// scripts.js

// --- CONFIGURACI√ìN ---
const API_BASE_URL = 'https://nombre-unico-de-tu-api-flask.fly.dev/api/v1/cultivos';

// --- NUEVAS CONFIGURACIONES DE AUTENTICACI√ìN ---
const API_REGISTRO_URL = 'https://nombre-unico-de-tu-api-flask.fly.dev/auth/registro';
const API_LOGIN_URL = 'https://nombre-unico-de-tu-api-flask.fly.dev/auth/login';

// Elementos del DOM para autenticaci√≥n
const authContainer = document.getElementById('auth-container');
const dashboardContainer = document.getElementById('dashboard-container');
const loginForm = document.getElementById('login-form');
const registroForm = document.getElementById('registro-form');
const logoutButton = document.getElementById('logout-button');
const authMessage = document.getElementById('auth-message');

// Variable global para el estado de autenticaci√≥n (NO USAMOS TOKENS POR SIMPLICIDAD)
let IS_AUTHENTICATED = false;

// ... (El resto de tus configuraciones y variables existentes) ...


// --- NUEVAS FUNCIONES DE AUTENTICACI√ìN ---

/**
 * Muestra u oculta los contenedores de Auth y Dashboard.
 */
function toggleInterface(isAuthenticated) {
    if (isAuthenticated) {
        authContainer.style.display = 'none';
        dashboardContainer.style.display = 'block';
        // Una vez dentro, cargamos los datos
        cargarCultivos(); 
    } else {
        authContainer.style.display = 'block';
        dashboardContainer.style.display = 'none';
    }
}

/**
 * Intenta registrar un nuevo usuario.
 */
async function manejarRegistro(event) {
    event.preventDefault();
    authMessage.textContent = ''; 

    const usuario = document.getElementById('registro-usuario').value;
    const contrase√±a = document.getElementById('registro-contrase√±a').value;

    try {
        const response = await fetch(API_REGISTRO_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ usuario, contrase√±a }),
        });

        const resultado = await response.json();

        if (response.ok) {
            authMessage.textContent = resultado.mensaje;
            authMessage.style.color = 'var(--color-primary)';
            registroForm.reset();
        } else {
            authMessage.textContent = `‚ùå Error: ${resultado.error || 'Fallo en el registro'}`;
            authMessage.style.color = 'var(--color-danger)';
        }
    } catch (error) {
        authMessage.textContent = '‚ùå Error de conexi√≥n al registrar.';
        authMessage.style.color = 'var(--color-danger)';
    }
}

/**
 * Intenta iniciar sesi√≥n.
 */
async function manejarLogin(event) {
    event.preventDefault();
    authMessage.textContent = ''; 
    
    const usuario = document.getElementById('login-usuario').value;
    const contrase√±a = document.getElementById('login-contrase√±a').value;

    try {
        const response = await fetch(API_LOGIN_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ usuario, contrase√±a }),
        });

        const resultado = await response.json();

        if (response.ok) {
            // √âxito en el login
            IS_AUTHENTICATED = true;
            toggleInterface(true);
        } else {
            authMessage.textContent = `‚ùå Error: ${resultado.error || 'Fallo en la autenticaci√≥n'}`;
            authMessage.style.color = 'var(--color-danger)';
        }
    } catch (error) {
        authMessage.textContent = '‚ùå Error de conexi√≥n al intentar iniciar sesi√≥n.';
        authMessage.style.color = 'var(--color-danger)';
    }
}

/**
 * Cierra la sesi√≥n y vuelve a la pantalla de login.
 */
function cerrarSesion() {
    IS_AUTHENTICATED = false;
    toggleInterface(false);
    alert('Sesi√≥n cerrada.');
    // Limpiar el formulario de login/registro si es necesario
    document.getElementById('login-form').reset();
}


// --- MODIFICACI√ìN DE LA INICIALIZACI√ìN ---

// Reemplaza o modifica la secci√≥n de inicializaci√≥n 'DOMContentLoaded'
document.addEventListener('DOMContentLoaded', () => {
    // Inicialmente, mostramos la interfaz de login
    toggleInterface(false); 
    
    // Asignar manejadores de eventos a los formularios de Auth
    loginForm.addEventListener('submit', manejarLogin);
    registroForm.addEventListener('submit', manejarRegistro);
    logoutButton.addEventListener('click', cerrarSesion);

    // NOTA: La funci√≥n cargarCultivos() ahora se llama *dentro* de toggleInterface(true)
    // despu√©s de un inicio de sesi√≥n exitoso.

    // ... (El resto de tus event listeners existentes deben estar aqu√≠, si los tienes)
});

// Aseg√∫rate de que TODAS tus funciones CRUD (cargarCultivos, manejarEnvioFormulario, eliminarCultivo)
// sigan usando 'API_BASE_URL' para acceder a los datos de cultivos.

Pasos Finales de Despliegue
Guarda los cambios en tu index.html.

Guarda los cambios en tu scripts.js.

Sube a GitHub:

git add index.html scripts.js 
git commit -m "feat: A√±adida interfaz de login/registro y l√≥gica de autenticaci√≥n."
git push

Vercel Despliega Autom√°ticamente: Vercel tomar√° los cambios y actualizar√° tu Dashboard en https://ventasinvernadero.vercel.app/.

Una vez que Vercel termine, al acceder a tu URL, solo ver√°s los formularios de Registro/Login.

Prueba:

Reg√≠strate con un nuevo usuario y contrase√±a.

Inicia sesi√≥n con ese mismo usuario.

Si es exitoso, ¬°deber√≠as ver tu Dashboard de Cultivos!












        
